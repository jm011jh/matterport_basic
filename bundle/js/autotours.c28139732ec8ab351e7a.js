/*! For license information please see autotours.c28139732ec8ab351e7a.js.LICENSE.txt */
(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[587],{248:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ImportAutoGallery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"importAutoGallery"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[]}]}}],loc:{start:0,end:85}};t.loc.source={body:"mutation ImportAutoGallery($modelId: ID!) {\n  importAutoGallery(modelId: $modelId)\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function a(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.ImportAutoGallery=function(e,t){var i={kind:e.kind,definitions:[a(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=n[t]||new Set,s=new Set,r=new Set;for(o.forEach((function(e){r.add(e)}));r.size>0;){var l=r;r=new Set,l.forEach((function(e){s.has(e)||(s.add(e),(n[e]||new Set).forEach((function(e){r.add(e)})))}))}return s.forEach((function(t){var n=a(e,t);n&&i.definitions.push(n)})),i}(t,"ImportAutoGallery")},47067:(e,t,i)=>{"use strict";i.d(t,{P:()=>o});var n=i(12554),a=i(85616);class o extends a.v{constructor(e){super(),this.reel=(0,n.Z)([]),this.modified=new Date,this.mode=e,this.commit()}replace(e){this.atomic((()=>{this.sid=e.sid,this.reel.replace(Array.from(e.reel.values())),this.mode=e.mode,this.modified=e.modified}))}}},37e3:(e,t,i)=>{"use strict";i.d(t,{Wu:()=>f});var n=i(10843),a=i(13893),o=i(1333),s=i(25481),r=i(44094),l=i(74381),d=i(72853),c=i(57186),u=i(93877);const m=new n.Ay("mds-reel-element-serializer"),p={[l.ES.FADE_TO_BLACK]:a.fl.FadeToBlack,[l.ES.INSTANT]:a.fl.Instant,[l.ES.INTERPOLATE]:a.fl.Interpolate},h={[l.Zw.LEFT]:o.ND.Left,[l.Zw.RIGHT]:o.ND.Right,[l.Zw.AUTO]:o.ND.Auto};class f{constructor(e){this.sweepTagRequirements=e,this.assetDeserializer=new d.S,this.viewDeserailizer=new c.K}deserialize(e){var t;if(!e||!(null===(t=null==e?void 0:e.asset)||void 0===t?void 0:t.id))return m.debug("Deserialized invalid highlight reel entry from MDS",e),null;const i=e.overrides,n={},a=(null==i?void 0:i.transitionType)?p[null==i?void 0:i.transitionType]:void 0,o=(null==i?void 0:i.panDirection)?h[null==i?void 0:i.panDirection]:void 0,l=null==i?void 0:i.panAngle;(0,r.s)(a)&&(n.transitionType=a),(0,r.s)(o)&&(n.panDirection=o),(0,s.Et)(l)&&(n.panAngle=l);const d=this.assetDeserializer.deserialize(e.asset),c=null==d?void 0:d.metadata.scanTags,f=!this.sweepTagRequirements||!c||c.includes(this.sweepTagRequirements);if(!d||!f)return null;let v;const w=this.viewDeserailizer.getModelViewType(e.sourceView);w!==u.jK.DEFURNISH&&w!==u.jK.DIGIPRO_SESSION||(v=e.sourceView.id),d.sourceViewId=v;const g={id:e.asset.id,overrides:n,snapshot:d,sourceViewId:v};return e.title&&(g.title=e.title),e.description&&(g.description=e.description),g}}},84261:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>O});var n=i(65945),a=i(75578),o=i(27947),s=i(90082),r=i(71687),l=i(28165),d=i(2993),c=i(10843),u=i(64650),m=i(73094),p=i(47067),h=i(93327),f=i(56388),v=i(24790),w=i(37e3);const g=new c.Ay("get-highlights-for-view"),y=async({client:e,modelId:t,viewType:i})=>{var n,a,o,s,r;const l=[],d=e||(0,f.H)({baseUrl:window.location.origin,server:v.wD})(),c={modelId:t,viewType:i},{data:u}=await d.query(h.GetHighlightReelForView,c),m=new w.Wu(null);return null===(r=null===(s=null===(o=null===(a=null===(n=null==u?void 0:u.model)||void 0===n?void 0:n.view)||void 0===a?void 0:a.model)||void 0===o?void 0:o.activeHighlightReel)||void 0===s?void 0:s.reel)||void 0===r||r.forEach((e=>{const t=m.deserialize(e);t?l.push(t):g.warn("Failed to deserialize reel")})),l};var I=i(248);const T=async({client:e,modelId:t})=>{const i=e||(0,f.H)({baseUrl:window.location.origin,server:v.wD})(),n={modelId:t},{data:a}=await i.query(I.ImportAutoGallery,n);return!!(null==a?void 0:a.importAutoGallery)};var D=i(74381),b=i(13893);class S{async generateTour(e){const{modelId:t}=e;await T({modelId:t});const i=await y({modelId:t,viewType:"matterport.user.insights"});i.forEach((e=>{e.overrides={transitionType:b.fl.Interpolate}}));const n=new p.P(D.UR.STORY);return n.reel.replace(this.sort(i)),n}sort(e){return e}}class E{async generateTour(e){const{modelId:t}=e;await T({modelId:t});const i=await y({modelId:t,viewType:"matterport.user.insights"}),n=new p.P(D.UR.REEL);return n.reel.replace(i),n}}var k=function(e,t,i,n){var a,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var r=e.length-1;r>=0;r--)(a=e[r])&&(s=(o<3?a(s):o>3?a(t,i,s):a(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s},A=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},R=function(e,t){return function(i,n){t(i,n,e)}};let O=class extends a.n{constructor({data:e},{data:t},{policyData:i},n,{data:a},o){super(),this.name="tours-generator",this.templates=new Map,this.applicationData=e,this.modelData=t,this.settingsModule=n,this.sweepData=a,this.toursDataModule=o,this.enabled=(0,m.W)(i,n.settingsData),c.Ay.for(this).info("AUTO TOURS ENABLED")}async init(e,t){this.registerTemplates(),this.registerSettings();const i=this.settingsModule.tryGetProperty(l.pH,!1);if(this.applicationData.application===o.lg.SHOWCASE&&i){const e=this.settingsModule.tryGetProperty(l.Ye,l.lB);this.generateTourFromTemplate(e,{modelId:this.modelData.model.baseModelId})}}async generateTourFromTemplate(e,t){if(!this.enabled)throw new Error("Tour generation is not enabled");const i=this.templates.get(e);if(!i)throw new Error(`Template ${e} not found`);const n=await i.generateTour(t);n.reel.forEach((e=>{if(!e.snapshot.metadata.scanId&&e.snapshot.metadata.cameraPosition){const t=this.sweepData.getClosestSweep(e.snapshot.metadata.cameraPosition,!0);t&&(e.snapshot.metadata.scanId=t.id)}"dollhouse"===e.snapshot.name&&(e.snapshot.metadata.cameraMode=d.N3.Dollhouse,e.snapshot.metadata.scanId=void 0),e.title="",e.description=""})),this.replaceActiveReel(n)}replaceActiveReel(e){this.toursDataModule.setHighlightReel(e)}registerTemplates(){this.templates.size>0||(this.templates.set(u.p.SCOUT,new S),this.templates.set(u.p.VISION,new E))}registerSettings(){const e="Tour Generator";this.settingsModule.registerMenuEntry({header:e,urlParam:!0,setting:l.Ye,options:[...this.templates.keys()],initialValue:()=>l.lB}),this.settingsModule.registerMenuEntry({header:e,urlParam:!0,setting:l.pH,initialValue:()=>!1})}};O=k([(0,n._q)(),R(0,(0,n.y_)(s.WJ)),R(1,(0,n.y_)(r.bj)),R(2,(0,n.y_)(r.Uu)),R(3,(0,n.y_)(s.ZF)),R(4,(0,n.y_)(r.Wh)),R(5,(0,n.y_)(r.XQ)),A("design:paramtypes",[Object,Object,Object,Object,Object,Object])],O)}}]);